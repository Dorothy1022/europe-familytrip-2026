<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>åŒ—æ­æ—…ç¨‹å°å¹«æ‰‹ Pro</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/4.1.0/vuedraggable.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .group-holland { border-left: 5px solid #3b82f6; }
        .group-baltic { border-left: 5px solid #f97316; }
        [v-cloak] { display: none; }
        .ghost-card { opacity: 0.5; background: #e2e8f0; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
        .active-nav { color: #3b82f6; transform: translateY(-2px); }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-900 overflow-hidden">
    <div id="app" v-cloak class="h-screen flex flex-col">
        
        <header class="bg-white pt-4 px-4 border-b shrink-0">
            <div class="flex justify-between items-center mb-3">
                <h1 class="text-xl font-black italic tracking-tighter text-slate-800">NORDIC 2026</h1>
                <div class="flex bg-slate-100 p-1 rounded-xl text-xs font-bold">
                    <button @click="currentGroup = 'all'" :class="currentGroup === 'all' ? 'bg-white shadow-sm' : ''" class="px-3 py-1.5 rounded-lg transition-all">å…¨é«”</button>
                    <button @click="currentGroup = 'holland'" :class="currentGroup === 'holland' ? 'bg-blue-500 text-white' : ''" class="px-3 py-1.5 rounded-lg transition-all text-blue-500">è·è˜­</button>
                    <button @click="currentGroup = 'baltic'" :class="currentGroup === 'baltic' ? 'bg-orange-500 text-white' : ''" class="px-3 py-1.5 rounded-lg transition-all text-orange-500">ä¸‰å°åœ‹</button>
                </div>
            </div>

            <div class="flex overflow-x-auto hide-scrollbar space-x-6 pb-2">
                <div v-for="date in dateRange" :key="date" 
                     @click="selectedDate = date"
                     :class="selectedDate === date ? 'text-blue-600 border-b-2 border-blue-600 font-bold' : 'text-slate-400'"
                     class="whitespace-nowrap px-1 py-1 text-sm cursor-pointer transition-all">
                    {{ formatDate(date) }}
                </div>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto hide-scrollbar pb-24 relative">
            
            <section v-if="activeTab === 'schedule'" class="p-4">
                <draggable v-model="schedule" item-key="id" handle=".handle" ghost-class="ghost-card" @end="updateMap">
                    <template #item="{element, index}">
                        <div v-if="shouldShow(element)" class="mb-3 bg-white p-4 rounded-2xl shadow-sm flex items-center gap-3 transition-active" 
                             :class="element.group === 'holland' ? 'group-holland' : 'group-baltic'"
                             @click="openEditModal(element)">
                            <div class="handle text-slate-300 cursor-grab px-1"><i class="fas fa-grip-lines"></i></div>
                            <div class="flex-1">
                                <div class="text-[10px] font-bold uppercase text-slate-400">{{ element.time }}</div>
                                <div class="font-bold text-slate-800">{{ element.location }}</div>
                                <div v-if="element.note" class="text-xs text-slate-500 mt-1 line-clamp-1"><i class="far fa-sticky-note mr-1"></i>{{ element.note }}</div>
                            </div>
                            <div class="relative group">
                                <button @click.stop="toggleMenu(element.id)" class="p-2 text-slate-400"><i class="fas fa-ellipsis-h"></i></button>
                                <div v-if="activeMenuId === element.id" class="absolute right-0 top-8 bg-white shadow-xl rounded-xl border z-50 py-2 w-32">
                                    <button @click.stop="copyItem(element)" class="w-full text-left px-4 py-2 text-sm hover:bg-slate-50"><i class="far fa-copy mr-2"></i>è¤‡è£½</button>
                                    <button @click.stop="deleteItem(element.id)" class="w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-50"><i class="far fa-trash-alt mr-2"></i>åˆªé™¤</button>
                                </div>
                            </div>
                        </div>
                    </template>
                </draggable>
                <button @click="openAddModal" class="w-full py-4 bg-white border-2 border-dashed border-slate-200 rounded-2xl text-slate-400 font-bold hover:bg-slate-100 transition-colors">+ æ–°å¢è¡Œç¨‹é»</button>
            </section>

            <section v-if="activeTab === 'map'" class="h-full flex flex-col">
                <div class="flex-1 bg-slate-200 relative">
                    <div class="absolute inset-0 flex items-center justify-center text-slate-400 font-bold italic">
                        <i class="fas fa-map-marked-alt text-4xl mb-2 block"></i>
                        <p>å·²ç‚º {{ currentGroupText }} åŠ è¼‰ {{ filteredSchedule.length }} å€‹åœ°é»</p>
                    </div>
                    <iframe class="w-full h-full grayscale-[20%] contrast-[1.1]" 
                            src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d100000!2d18.0686!3d59.3293!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1szh-TW!2stw!4v1" 
                            allowfullscreen></iframe>
                </div>
            </section>

            <section v-if="activeTab === 'split'" class="p-4 space-y-4">
                <div class="bg-slate-900 text-white p-5 rounded-[2rem] shadow-xl overflow-hidden">
                    <div @click="showTotalDetail = !showTotalDetail" class="flex justify-between items-center cursor-pointer">
                        <div>
                            <p class="text-[10px] uppercase tracking-widest opacity-60">ç¸½æ”¯å‡ºé è¦½ (EUR)</p>
                            <p class="text-3xl font-black">â‚¬ {{ totalSpent.toFixed(2) }}</p>
                        </div>
                        <i class="fas transition-transform duration-300" :class="showTotalDetail ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                    </div>
                    
                    <div v-show="showTotalDetail" class="mt-4 pt-4 border-t border-white/10 max-h-60 overflow-y-auto hide-scrollbar">
                        <div v-for="exp in filteredExpenses" class="flex justify-between text-sm mb-3">
                            <span class="opacity-70">{{ exp.desc }} ({{ exp.payer }})</span>
                            <span class="font-mono">â‚¬ {{ (exp.currency === 'TWD' ? exp.amount / exp.rate : exp.amount).toFixed(2) }}</span>
                        </div>
                    </div>
                </div>

                <div class="flex overflow-x-auto hide-scrollbar gap-3 pb-2">
                    <div v-for="person in members" :key="person" class="min-w-[100px] bg-white p-3 rounded-2xl shadow-sm border border-slate-100">
                        <p class="text-[10px] text-slate-400 font-bold">{{ person }}</p>
                        <p class="text-sm font-black" :class="balances[person] >= 0 ? 'text-green-500' : 'text-red-500'">
                            {{ balances[person] >= 0 ? '+' : '' }}{{ balances[person].toFixed(1) }}
                        </p>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-3xl shadow-sm">
                    <div class="calendar-grid mb-2">
                        <div v-for="day in ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­']" class="text-[10px] text-center text-slate-400">{{ day }}</div>
                    </div>
                    <div class="calendar-grid">
                        <div v-for="day in fullCalendarDates" :key="day" 
                             @click="selectedDate = day"
                             class="aspect-square flex flex-col items-center justify-center rounded-xl text-xs relative cursor-pointer"
                             :class="selectedDate === day ? 'bg-blue-600 text-white shadow-lg' : 'hover:bg-slate-50'">
                            <span>{{ day.split('-')[2] }}</span>
                            <div v-if="hasExpense(day)" class="w-1 h-1 bg-orange-400 rounded-full mt-0.5"></div>
                        </div>
                    </div>
                </div>

                <div class="space-y-3">
                    <div v-for="exp in filteredExpenses" @click="openEditExpense(exp)" class="bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm" :class="exp.group === 'holland' ? 'bg-blue-100 text-blue-600' : 'bg-orange-100 text-orange-600'">
                                {{ exp.payer[0] }}
                            </div>
                            <div>
                                <p class="font-bold text-slate-800">{{ exp.desc }}</p>
                                <p class="text-[10px] text-slate-400 uppercase tracking-tighter">{{ exp.payer }} ä»˜æ¬¾ Â· åˆ†æ”¤: {{ exp.splitWith.length }}äºº</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-mono font-black text-slate-800">{{ exp.currency === 'TWD' ? 'NT$' : 'â‚¬' }} {{ exp.amount }}</p>
                            <p v-if="exp.currency === 'TWD'" class="text-[9px] text-slate-300">ç´„ â‚¬ {{ (exp.amount/exp.rate).toFixed(1) }}</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <nav class="bg-white/80 backdrop-blur-md border-t flex justify-around items-center safe-bottom h-20 shrink-0 z-40">
            <button @click="activeTab = 'schedule'" :class="{ 'active-nav': activeTab === 'schedule' }" class="flex flex-col items-center transition-all">
                <i class="fas fa-route text-xl"></i><span class="text-[10px] font-bold mt-1">è¡Œç¨‹</span>
            </button>
            <button @click="activeTab = 'map'" :class="{ 'active-nav': activeTab === 'map' }" class="flex flex-col items-center transition-all">
                <i class="fas fa-map-marked-alt text-xl"></i><span class="text-[10px] font-bold mt-1">åœ°åœ–</span>
            </button>
            <div @click="activeTab === 'split' ? showExpenseModal = true : openAddModal()" class="w-14 h-14 bg-slate-900 text-white rounded-full flex items-center justify-center shadow-lg -mt-10 border-4 border-slate-50">
                <i class="fas fa-plus text-xl"></i>
            </div>
            <button @click="activeTab = 'split'" :class="{ 'active-nav': activeTab === 'split' }" class="flex flex-col items-center transition-all">
                <i class="fas fa-receipt text-xl"></i><span class="text-[10px] font-bold mt-1">åˆ†å¸³</span>
            </button>
        </nav>

        <div v-if="showTripModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-end">
            <div class="bg-white w-full rounded-t-[2.5rem] p-6 pb-10 shadow-2xl animate-slide-up">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-black">{{ isEditing ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢ç›®çš„åœ°' }}</h2>
                    <button @click="showTripModal = false" class="text-slate-300 hover:text-slate-900 text-2xl"><i class="fas fa-times-circle"></i></button>
                </div>
                
                <div class="space-y-4">
                    <div class="relative">
                        <input v-model="tempTrip.location" @input="showSuggestions = true" placeholder="æœå°‹åœ°é» (Google Maps å¼é¸é …)" class="w-full p-4 bg-slate-50 rounded-2xl border-none focus:ring-2 focus:ring-blue-500 outline-none font-bold">
                        <div v-if="showSuggestions && tempTrip.location" class="absolute left-0 right-0 top-14 bg-white shadow-xl rounded-2xl border z-[110] overflow-hidden">
                            <div v-for="s in mockSuggestions" @click="selectLocation(s)" class="p-4 hover:bg-slate-50 border-b last:border-0 flex items-center gap-3 cursor-pointer">
                                <i class="fas fa-map-marker-alt text-slate-300"></i>
                                <span>{{ s }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex gap-3">
                        <input v-model="tempTrip.time" type="time" class="flex-1 p-4 bg-slate-50 rounded-2xl border-none outline-none font-bold">
                        <select v-model="tempTrip.group" class="flex-1 p-4 bg-slate-50 rounded-2xl border-none outline-none font-bold">
                            <option value="all">ğŸŒ å…¨éƒ¨</option>
                            <option value="holland">ğŸ”µ è·è˜­çµ„</option>
                            <option value="baltic">ğŸŸ  ä¸‰å°åœ‹</option>
                        </select>
                    </div>

                    <textarea v-model="tempTrip.note" placeholder="å‚™è¨» (ä¾‹å¦‚ï¼šè¨‚ä½ç·¨è™Ÿã€å¿…è²·æ¸…å–®...)" class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none h-24 font-medium"></textarea>
                    
                    <div class="flex gap-3 pt-4">
                        <button @click="showTripModal = false" class="flex-1 py-4 bg-slate-100 text-slate-500 rounded-2xl font-bold">å–æ¶ˆ</button>
                        <button @click="saveTrip" class="flex-[2] py-4 bg-slate-900 text-white rounded-2xl font-bold shadow-lg shadow-slate-200">å„²å­˜è¡Œç¨‹</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="showExpenseModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-end">
            <div class="bg-white w-full rounded-t-[2.5rem] p-6 pb-10 shadow-2xl animate-slide-up overflow-y-auto max-h-[90vh]">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-black">{{ isEditingExp ? 'ä¿®æ”¹æ”¯å‡º' : 'æ–°å¢æ”¯å‡ºé …ç›®' }}</h2>
                    <button @click="showExpenseModal = false" class="text-slate-300 text-2xl"><i class="fas fa-times-circle"></i></button>
                </div>
                
                <div class="space-y-4">
                    <input v-model="tempExp.desc" placeholder="é …ç›®å…§å®¹" class="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold">
                    
                    <div class="flex gap-3">
                        <input v-model.number="tempExp.amount" type="number" placeholder="é‡‘é¡" class="flex-[2] p-4 bg-slate-50 rounded-2xl outline-none font-bold text-lg">
                        <select v-model="tempExp.currency" class="flex-1 p-4 bg-slate-50 rounded-2xl outline-none font-bold">
                            <option value="EUR">â‚¬ EUR</option>
                            <option value="TWD">NT$ TWD</option>
                        </select>
                    </div>

                    <div v-if="tempExp.currency === 'TWD'" class="p-4 bg-blue-50 rounded-2xl flex justify-between items-center">
                        <span class="text-xs text-blue-600 font-bold">æ­å…ƒåŒ¯ç‡ (1â‚¬ =)</span>
                        <input v-model.number="exchangeRate" type="number" class="w-20 bg-transparent text-right border-b border-blue-200 outline-none font-mono font-bold">
                    </div>

                    <div>
                        <p class="text-[10px] font-black uppercase text-slate-400 mb-2">ä»˜æ¬¾äºº</p>
                        <div class="flex gap-2 overflow-x-auto hide-scrollbar">
                            <button v-for="p in members" @click="tempExp.payer = p" 
                                    :class="tempExp.payer === p ? 'bg-slate-900 text-white' : 'bg-slate-50'"
                                    class="px-4 py-2 rounded-full whitespace-nowrap text-xs font-bold transition-all">{{ p }}</button>
                        </div>
                    </div>

                    <div>
                        <p class="text-[10px] font-black uppercase text-slate-400 mb-2">åˆ†æ”¤å°è±¡ (å¯è¤‡é¸)</p>
                        <div class="flex flex-wrap gap-2">
                            <button @click="toggleSplitGroup('all')" class="px-3 py-1.5 rounded-xl border-2 border-slate-100 text-[10px] font-bold">å…¨é«”</button>
                            <button @click="toggleSplitGroup('holland')" class="px-3 py-1.5 rounded-xl border-2 border-blue-100 text-[10px] font-bold text-blue-500">è·è˜­çµ„</button>
                            <button @click="toggleSplitGroup('baltic')" class="px-3 py-1.5 rounded-xl border-2 border-orange-100 text-[10px] font-bold text-orange-500">ä¸‰å°åœ‹</button>
                        </div>
                        <div class="grid grid-cols-3 gap-2 mt-3">
                            <label v-for="p in members" class="flex items-center gap-2 p-2 bg-slate-50 rounded-xl cursor-pointer">
                                <input type="checkbox" :value="p" v-model="tempExp.splitWith" class="rounded text-blue-500">
                                <span class="text-xs font-bold">{{ p }}</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                        <button v-if="isEditingExp" @click="deleteExpense" class="flex-1 py-4 bg-red-50 text-red-500 rounded-2xl font-bold">åˆªé™¤</button>
                        <button @click="saveExpense" class="flex-[2] py-4 bg-slate-900 text-white rounded-2xl font-bold shadow-lg shadow-slate-200">å„²å­˜æ”¯å‡º</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, watch, onMounted } = Vue;

        createApp({
            components: { 'draggable': window.vuedraggable },
            setup() {
                const activeTab = ref('schedule');
                const currentGroup = ref('all');
                const selectedDate = ref('2026-03-19');
                const showTotalDetail = ref(false);
                const exchangeRate = ref(37);
                const activeMenuId = ref(null);

                // åŸºæœ¬è³‡æ–™
                const members = ['åª½åª½', 'ä½©çª', 'æ©çª', 'ä¸€ä¼‘', 'éŒ¦ç›†'];
                const groupMembers = {
                    holland: ['åª½åª½', 'ä½©çª', 'éŒ¦ç›†'],
                    baltic: ['æ©çª', 'ä¸€ä¼‘'],
                    all: ['åª½åª½', 'ä½©çª', 'æ©çª', 'ä¸€ä¼‘', 'éŒ¦ç›†']
                };

                // è¡Œç¨‹è³‡æ–™
                const schedule = ref([
                    { id: 1, date: '2026-03-19', time: '14:00', location: 'é˜¿å§†æ–¯ç‰¹ä¸¹å²åŸºæµ¦æ©Ÿå ´', group: 'all', note: 'é ˜è¡Œæã€è²·äº¤é€šå¡' },
                    { id: 2, date: '2026-03-19', time: '16:00', location: 'åº«è‚¯éœå¤«èŠ±åœ’', group: 'holland', note: 'é¬±é‡‘é¦™å­£' },
                    { id: 3, date: '2026-03-20', time: '10:00', location: 'ç¾Šè§’æ‘', group: 'holland', note: '' }
                ]);

                // æ”¯å‡ºè³‡æ–™
                const expenses = ref([
                    { id: 1, date: '2026-03-19', desc: 'æ©Ÿå ´åˆé¤', amount: 80, currency: 'EUR', payer: 'åª½åª½', splitWith: members, rate: 37, group: 'all' }
                ]);

                // ç”Ÿæˆæ—¥æœŸç¯„åœ 3/19 - 4/4
                const dateRange = [];
                const start = new Date('2026-03-19');
                const end = new Date('2026-04-04');
                for(let d = start; d <= end; d.setDate(d.getDate() + 1)) {
                    dateRange.push(d.toISOString().split('T')[0]);
                }

                // æœˆæ›†ç›¸é—œ
                const fullCalendarDates = computed(() => {
                    const days = [];
                    const firstDay = new Date('2026-03-01'); // å¾3æœˆé–‹å§‹é¡¯ç¤º
                    for(let i = 0; i < 35; i++) {
                        const d = new Date(firstDay);
                        d.setDate(d.getDate() + i);
                        days.push(d.toISOString().split('T')[0]);
                    }
                    return days;
                });

                // éæ¿¾è¡Œç¨‹
                const filteredSchedule = computed(() => {
                    return schedule.value
                        .filter(item => item.date === selectedDate.value)
                        .filter(item => currentGroup.value === 'all' || item.group === currentGroup.value || item.group === 'all')
                        .sort((a, b) => a.time.localeCompare(b.time));
                });

                const shouldShow = (item) => item.date === selectedDate.value && (currentGroup.value === 'all' || item.group === currentGroup.value || item.group === 'all');

                // éæ¿¾æ”¯å‡º
                const filteredExpenses = computed(() => {
                    let exps = expenses.value.filter(e => e.date === selectedDate.value);
                    if(currentGroup.value !== 'all') {
                        exps = exps.filter(e => {
                            const intersect = e.splitWith.filter(m => groupMembers[currentGroup.value].includes(m));
                            return intersect.length > 0;
                        });
                    }
                    return exps;
                });

                // è¨ˆç®—é¤˜é¡ (æ¯å€‹äººæ‡‰æ”¶/æ‡‰ä»˜)
                const balances = computed(() => {
                    let b = {};
                    members.forEach(m => b[m] = 0);
                    expenses.value.forEach(e => {
                        const amtInEUR = e.currency === 'TWD' ? e.amount / e.rate : e.amount;
                        b[e.payer] += amtInEUR;
                        const share = amtInEUR / e.splitWith.length;
                        e.splitWith.forEach(m => b[m] -= share);
                    });
                    return b;
                });

                const totalSpent = computed(() => {
                    return expenses.value.reduce((sum, e) => {
                        const amt = e.currency === 'TWD' ? e.amount / e.rate : e.amount;
                        return sum + amt;
                    }, 0);
                });

                // Modal æ§åˆ¶ - è¡Œç¨‹
                const showTripModal = ref(false);
                const isEditing = ref(false);
                const tempTrip = ref({});
                const showSuggestions = ref(false);
                const mockSuggestions = ['æ–¯å¾·å“¥çˆ¾æ‘©ç‹å®®', 'ç“¦è–©æ²‰èˆ¹åšç‰©é¤¨', 'é˜¿æ¯”æ–¯åº«åœ‹å®¶å…¬åœ’', 'å“¥æœ¬å“ˆæ ¹æ–°æ¸¯', 'èµ«çˆ¾è¾›åŸºå¤§æ•™å ‚'];

                const openAddModal = () => {
                    isEditing.value = false;
                    tempTrip.value = { id: Date.now(), date: selectedDate.value, time: '10:00', location: '', group: currentGroup.value, note: '' };
                    showTripModal.value = true;
                };

                const openEditModal = (item) => {
                    isEditing.value = true;
                    tempTrip.value = { ...item };
                    showTripModal.value = true;
                };

                const selectLocation = (loc) => {
                    tempTrip.value.location = loc;
                    showSuggestions.value = false;
                };

                const saveTrip = () => {
                    if(!tempTrip.value.location) return;
                    if(isEditing.value) {
                        const idx = schedule.value.findIndex(s => s.id === tempTrip.value.id);
                        schedule.value[idx] = { ...tempTrip.value };
                    } else {
                        schedule.value.push({ ...tempTrip.value });
                    }
                    showTripModal.value = false;
                };

                const deleteItem = (id) => {
                    schedule.value = schedule.value.filter(s => s.id !== id);
                    activeMenuId.value = null;
                };

                const copyItem = (item) => {
                    const newItem = { ...item, id: Date.now(), location: item.location + ' (å‰¯æœ¬)' };
                    schedule.value.push(newItem);
                    activeMenuId.value = null;
                };

                // Modal æ§åˆ¶ - æ”¯å‡º
                const showExpenseModal = ref(false);
                const isEditingExp = ref(false);
                const tempExp = ref({});

                const openEditExpense = (exp) => {
                    isEditingExp.value = true;
                    tempExp.value = { ...exp, splitWith: [...exp.splitWith] };
                    showExpenseModal.value = true;
                };

                const saveExpense = () => {
                    if(!tempExp.value.amount) return;
                    tempExp.value.rate = exchangeRate.value;
                    if(isEditingExp.value) {
                        const idx = expenses.value.findIndex(e => e.id === tempExp.value.id);
                        expenses.value[idx] = { ...tempExp.value };
                    } else {
                        expenses.value.push({ ...tempExp.value, id: Date.now(), date: selectedDate.value });
                    }
                    showExpenseModal.value = false;
                };

                const deleteExpense = () => {
                    expenses.value = expenses.value.filter(e => e.id !== tempExp.value.id);
                    showExpenseModal.value = false;
                };

                const toggleSplitGroup = (g) => {
                    tempExp.value.splitWith = [...groupMembers[g]];
                };

                // å·¥å…·å‡½å¼
                const formatDate = (d) => {
                    const [y, m, day] = d.split('-');
                    return `${m}/${day}`;
                };

                const toggleMenu = (id) => {
                    activeMenuId.value = activeMenuId.value === id ? null : id;
                };

                const hasExpense = (d) => expenses.value.some(e => e.date === d);

                return {
                    activeTab, currentGroup, selectedDate, dateRange, members,
                    schedule, filteredSchedule, shouldShow,
                    expenses, filteredExpenses, totalSpent, balances,
                    showTotalDetail, exchangeRate, activeMenuId,
                    showTripModal, isEditing, tempTrip, showSuggestions, mockSuggestions,
                    showExpenseModal, isEditingExp, tempExp,
                    fullCalendarDates, hasExpense,
                    openAddModal, openEditModal, saveTrip, deleteItem, copyItem, selectLocation,
                    openEditExpense, saveExpense, deleteExpense, toggleSplitGroup,
                    formatDate, toggleMenu
                };
            }
        }).mount('#app');
    </script>

    <style>
        @keyframes slide-up {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .animate-slide-up { animation: slide-up 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .transition-active:active { transform: scale(0.96); opacity: 0.8; }
    </style>
</body>
</html>