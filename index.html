<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026家庭歐洲行 (全功能整合版)</title>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { -webkit-tap-highlight-color: transparent; background-color: #f8fafc; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .loading-overlay { position: fixed; inset: 0; background: white; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; text-align: center; }
        .calendar-cell { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 12px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s; position: relative; border: 1px solid transparent; }
        .calendar-cell.selected { background-color: #1e293b; color: white; }
        .calendar-cell.has-expense::after { content: ''; position: absolute; bottom: 6px; width: 4px; height: 4px; background-color: #ef4444; border-radius: 50%; }
        
        .fade-slide-enter-active, .fade-slide-leave-active { transition: all 0.3s ease; max-height: 800px; opacity: 1; }
        .fade-slide-enter-from, .fade-slide-leave-to { max-height: 0; opacity: 0; }
        
        #map { height: 100%; width: 100%; z-index: 1; }
    </style>
</head>
<body>

<div id="app" class="h-screen w-full max-w-md mx-auto bg-slate-50 flex flex-col shadow-2xl relative text-slate-800">
    <div v-if="!isLoaded" class="loading-overlay">
        <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-slate-800"></div>
    </div>

    <header class="bg-white/90 backdrop-blur-md px-5 py-4 shadow-sm z-20 flex justify-between items-center">
        <div>
            <h1 class="text-xl font-extrabold text-slate-900">2026 家庭歐洲行</h1>
            <div class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-0.5">Family Europe Trip</div>
        </div>
        <div class="flex flex-col items-end">
            <span class="px-2 py-1 bg-slate-100 rounded-md text-[10px] font-black text-slate-500 uppercase">{{ activeTab }}</span>
            <div v-if="weather" class="text-[10px] text-blue-500 font-bold mt-1">{{ weather }}</div>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto pb-24 no-scrollbar bg-slate-50">
        <div v-show="activeTab === 'itinerary'">
            <div class="sticky top-0 z-30 bg-white/80 backdrop-blur-md border-b">
                <div class="flex gap-2 p-4 overflow-x-auto no-scrollbar">
                    <button v-for="day in days" :key="day" @click="currentDay = day" :class="['px-4 py-2 rounded-xl text-sm font-bold flex-shrink-0 transition', currentDay === day ? 'bg-slate-800 text-white' : 'bg-slate-50 text-slate-400']">{{ day }}</button>
                </div>
                <div class="flex justify-center pb-3">
                    <div class="bg-slate-100 p-1 rounded-lg flex gap-1">
                        <button v-for="g in ['all', 'A', 'B']" :key="g" @click="itineraryGroup = g" :class="['px-3 py-1 rounded-md text-[10px] font-bold transition', itineraryGroup === g ? 'bg-white shadow-sm text-slate-800' : 'text-slate-400']">{{ g==='all'?'全部':(g==='A'?'荷蘭':'三小國') }}</button>
                    </div>
                </div>
            </div>
            <div id="itinerary-list" class="p-5 space-y-5">
                <div v-for="item in filteredItinerary" :key="item.id" @click="openEditItem(item)" class="bg-white p-4 rounded-2xl shadow-sm border-l-4 relative" :class="getGroupBorder(item.group)">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-xs font-bold text-slate-400">{{ item.time }}</span>
                        <span class="text-[10px] font-black px-2 py-0.5 rounded uppercase text-white" :class="getGroupBg(item.group)">{{ item.group }}</span>
                    </div>
                    <div class="font-bold text-slate-800 text-lg">{{ item.location }}</div>
                    <div v-if="item.note" class="text-xs text-slate-400 mt-1">{{ item.note }}</div>
                </div>
            </div>
        </div>

        <div v-show="activeTab === 'map'" class="h-full relative">
            <div id="map"></div>
            <div class="absolute top-4 left-0 right-0 z-[1000] px-4">
                <div class="bg-white/90 backdrop-blur-md p-2 rounded-2xl shadow-lg flex gap-2 overflow-x-auto no-scrollbar">
                    <button @click="mapDay = 'all'" :class="['px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap', mapDay === 'all' ? 'bg-slate-800 text-white' : 'bg-slate-100']">全覽模式</button>
                    <button v-for="day in days" :key="day" @click="mapDay = day" :class="['px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap', mapDay === day ? 'bg-blue-600 text-white' : 'bg-white border']">{{ day }}</button>
                </div>
            </div>
        </div>

        <div v-show="activeTab === 'expenses'" class="p-5 space-y-6">
            <div class="flex justify-center">
                <div class="bg-slate-200 p-1 rounded-xl flex gap-1 w-full max-w-xs">
                    <button v-for="g in ['all', 'A', 'B']" :key="g" @click="expenseFilter = g" :class="['flex-1 py-2 rounded-lg text-xs font-bold transition', expenseFilter === g ? 'bg-white shadow text-slate-800' : 'text-slate-400']">{{ g==='all'?'全部':(g==='A'?'荷蘭組':'三小國') }}</button>
                </div>
            </div>

            <div @click="showFullList = !showFullList" class="bg-slate-900 rounded-3xl p-6 text-white shadow-xl relative overflow-hidden cursor-pointer transition active:scale-95">
                <div class="relative z-10 flex justify-between items-end">
                    <div>
                        <p class="text-slate-400 text-xs font-bold mb-1">篩選後支出總計</p>
                        <h2 class="text-4xl font-black italic tracking-tighter">${{ filteredTotal.toLocaleString() }}</h2>
                    </div>
                    <i data-lucide="chevron-down" :class="['transition-transform', showFullList?'rotate-180':'']"></i>
                </div>
            </div>

            <transition name="fade-slide">
                <div v-if="showFullList" class="bg-white rounded-2xl shadow-inner border overflow-hidden">
                    <div class="max-h-[40vh] overflow-y-auto p-4 space-y-3">
                        <div v-for="exp in sortedFilteredExp" :key="exp.id" @click="openEditExp(exp)" class="flex justify-between items-center p-3 bg-slate-50 rounded-xl border-l-4" :class="getGroupBorder(exp.splitGroup)">
                            <div>
                                <div class="font-bold text-sm">{{ exp.title }}</div>
                                <div class="text-[10px] text-slate-400">{{ exp.date }} · {{ exp.payer }}付</div>
                            </div>
                            <div class="font-black text-slate-700">${{ Math.round(exp.twdAmount).toLocaleString() }}</div>
                        </div>
                    </div>
                </div>
            </transition>

            <div class="bg-white rounded-2xl shadow-sm border p-4">
                <div class="flex justify-between items-center mb-4">
                    <button @click="changeMonth(-1)" class="p-2 bg-slate-50 rounded-lg"><i data-lucide="chevron-left" class="w-4 h-4"></i></button>
                    <h3 class="font-black text-slate-800">{{ calYear }} / {{ String(calMonth+1).padStart(2,'0') }}</h3>
                    <button @click="changeMonth(1)" class="p-2 bg-slate-50 rounded-lg"><i data-lucide="chevron-right" class="w-4 h-4"></i></button>
                </div>
                <div class="calendar-grid">
                    <div v-for="w in ['日','一','二','三','四','五','六']" :key="w" class="text-[10px] font-black text-slate-300 py-1">{{ w }}</div>
                    <div v-for="(day, idx) in calendarDays" :key="idx" @click="day && (selDate = day.date)" :class="['calendar-cell', day && selDate === day.date ? 'selected' : '', day && day.hasExpense ? 'has-expense' : '', !day ? 'opacity-0' : '']">
                        {{ day ? day.day : '' }}
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                <div class="flex justify-between items-center">
                    <h3 class="font-black text-slate-800 text-lg">{{ selDate.split('-').slice(1).join('/') }} 明細</h3>
                    <div class="text-[10px] font-bold text-slate-400">當日小計: ${{ dailyTotal.toLocaleString() }}</div>
                </div>
                <div v-for="exp in dailyFilteredExp" :key="exp.id" @click="openEditExp(exp)" class="bg-white p-4 rounded-2xl shadow-sm border flex justify-between items-center relative overflow-hidden">
                    <div class="absolute left-0 top-0 bottom-0 w-1" :class="getGroupBg(exp.splitGroup)"></div>
                    <div class="pl-2">
                        <div class="font-bold text-slate-800 text-sm">{{ exp.title }}</div>
                        <div class="text-[10px] text-slate-400 mt-1">分攤: {{ (exp.targetMembers || []).join(', ') }}</div>
                    </div>
                    <div class="font-black text-slate-800">${{ Math.round(exp.twdAmount).toLocaleString() }}</div>
                </div>
            </div>
        </div>
    </main>

    <nav class="bg-white border-t p-4 flex justify-around safe-bottom absolute bottom-0 w-full z-40">
        <button v-for="t in ['itinerary', 'map', 'expenses']" :key="t" @click="switchTab(t)" :class="[activeTab === t ? 'text-slate-900 scale-110' : 'text-slate-300', 'transition-all']">
            <i :data-lucide="t === 'itinerary' ? 'calendar' : (t === 'map' ? 'map' : 'wallet')" class="w-6 h-6"></i>
        </button>
    </nav>

    <div v-if="showExpModal" class="fixed inset-0 bg-slate-900/60 z-[2000] flex items-end p-4 backdrop-blur-sm">
        <div class="bg-white w-full rounded-3xl p-6 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black text-slate-800">{{ isEdit ? '編輯支出' : '新增支出' }}</h3>
                <button @click="showExpModal = false" class="p-2 bg-slate-100 rounded-full"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            <div class="space-y-5">
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase">項目名稱</label>
                    <input v-model="form.title" placeholder="例如：晚餐、車票..." class="w-full mt-1 bg-slate-50 p-4 rounded-xl outline-none font-bold text-slate-700">
                </div>
                <div class="flex gap-3">
                    <div class="w-24">
                        <label class="text-[10px] font-black text-slate-400 uppercase">幣別</label>
                        <select v-model="form.currency" class="w-full mt-1 bg-slate-50 p-4 rounded-xl font-bold"><option value="EUR">EUR</option><option value="TWD">TWD</option></select>
                    </div>
                    <div class="flex-1">
                        <label class="text-[10px] font-black text-slate-400 uppercase">金額</label>
                        <input v-model.number="form.originalAmount" type="number" class="w-full mt-1 bg-slate-50 p-4 rounded-xl outline-none font-black text-lg">
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase mb-2 block">分攤對象 (可複選)</label>
                    <div class="grid grid-cols-3 gap-2">
                        <button v-for="m in members" :key="m" @click="toggleM(m)" :class="['py-3 rounded-xl text-xs font-bold border transition', form.targetMembers.includes(m) ? 'bg-blue-600 text-white border-blue-600 shadow-md' : 'text-slate-400 border-slate-100']">{{ m }}</button>
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase mb-2 block">誰先付錢？</label>
                    <div class="flex gap-2 flex-wrap">
                        <button v-for="m in members" :key="m" @click="form.payer = m" :class="['px-4 py-2 rounded-lg text-xs font-bold border', form.payer === m ? 'bg-slate-800 text-white shadow-md' : 'text-slate-400 border-slate-100']">{{ m }}</button>
                    </div>
                </div>
                <div class="flex gap-3 pt-4">
                    <button v-if="isEdit" @click="delExp" class="px-6 py-4 bg-red-50 text-red-500 rounded-2xl font-bold"><i data-lucide="trash-2"></i></button>
                    <button @click="saveExp" class="flex-1 py-4 bg-slate-900 text-white rounded-2xl font-black shadow-lg">儲存支出紀錄</button>
                </div>
            </div>
        </div>
    </div>

    <div v-if="showItemModal" class="fixed inset-0 bg-slate-900/60 z-[2000] flex items-end p-4 backdrop-blur-sm">
        <div class="bg-white w-full rounded-3xl p-6 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black text-slate-800">編輯行程</h3>
                <button @click="showItemModal = false" class="p-2 bg-slate-100 rounded-full"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            <div class="space-y-4">
                <input v-model="itemForm.location" class="w-full bg-slate-50 p-4 rounded-xl outline-none font-bold">
                <div class="flex gap-3">
                    <input v-model="itemForm.time" type="time" class="flex-1 bg-slate-50 p-4 rounded-xl font-bold">
                    <select v-model="itemForm.group" class="w-32 bg-slate-50 p-4 rounded-xl font-bold"><option value="all">全體</option><option value="A">荷蘭組</option><option value="B">三小國</option></select>
                </div>
                <textarea v-model="itemForm.note" class="w-full bg-slate-50 p-4 rounded-xl outline-none text-sm" rows="3" placeholder="備註..."></textarea>
                <div class="flex gap-3 pt-4">
                    <button @click="delItem" class="px-6 py-4 bg-red-50 text-red-500 rounded-2xl font-bold"><i data-lucide="trash-2"></i></button>
                    <button @click="saveItem" class="flex-1 py-4 bg-slate-900 text-white rounded-2xl font-black shadow-lg">儲存行程</button>
                </div>
            </div>
        </div>
    </div>

    <button v-if="activeTab === 'expenses'" @click="openAddExp" class="fixed bottom-24 right-5 w-14 h-14 bg-slate-900 text-white rounded-full shadow-2xl flex items-center justify-center z-30 transition hover:scale-110 active:scale-90"><i data-lucide="plus" class="w-8 h-8"></i></button>
    <button v-if="activeTab === 'itinerary'" @click="openAddItem" class="fixed bottom-24 right-5 w-14 h-14 bg-slate-900 text-white rounded-full shadow-2xl flex items-center justify-center z-30 transition hover:scale-110 active:scale-90"><i data-lucide="plus" class="w-8 h-8"></i></button>
</div>

<script type="module">
    import { createApp, ref, computed, onMounted, watch, nextTick } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref as dbRef, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC_trr15i7caUUFXdQeT54rjJj2CbPljlE",
        authDomain: "europetrip2026-d36f1.firebaseapp.com",
        databaseURL: "https://europetrip2026-d36f1-default-rtdb.firebaseio.com",
        projectId: "europetrip2026-d36f1",
        storageBucket: "europetrip2026-d36f1.firebasestorage.app",
        messagingSenderId: "368850353659",
        appId: "1:368850353659:web:8cc22ae3fcf13d11051f5e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    createApp({
        setup() {
            const activeTab = ref('itinerary');
            const isLoaded = ref(false);
            const currentDay = ref('3/19');
            const mapDay = ref('all');
            const itineraryGroup = ref('all');
            const expenseFilter = ref('all');
            const selDate = ref(new Date().toISOString().split('T')[0]);
            const calDate = ref(new Date(2026, 2, 1));
            const weather = ref('');
            const showFullList = ref(false);
            const showExpModal = ref(false);
            const showItemModal = ref(false);
            const isEdit = ref(false);
            
            const members = ['媽媽', '佩琪', '錦盆', '恩琪', '一休'];
            const groups = { all: members, A: ['媽媽', '佩琪', '錦盆'], B: ['恩琪', '一休'] };
            const days = ['3/19', '3/20', '3/21', '3/22', '3/23'];
            
            const itinerary = ref([]);
            const expenses = ref([]);
            const dayTitles = ref({});
            
            const form = ref({});
            const itemForm = ref({});
            let map = null, markers = L.layerGroup(), paths = L.layerGroup();

            const saveToCloud = () => {
                if(!isLoaded.value) return;
                set(dbRef(db, 'travel2026'), { itinerary: itinerary.value, expenses: expenses.value, dayTitles: dayTitles.value, days });
            };

            const switchTab = (t) => {
                activeTab.value = t;
                if(t === 'map') nextTick(() => { map.invalidateSize(); updateMap(); });
                nextTick(() => lucide.createIcons());
            };

            const updateMap = () => {
                markers.clearLayers(); paths.clearLayers();
                let points = [], pathA = [], pathB = [];
                let items = mapDay.value === 'all' ? itinerary.value : itinerary.value.filter(i => i.day === mapDay.value);
                
                items.sort((a,b) => (days.indexOf(a.day) - days.indexOf(b.day)) || a.time.localeCompare(b.time)).forEach(item => {
                    if(item.lat && item.lon) {
                        const color = item.group==='A'?'#14b8a6':(item.group==='B'?'#f97316':'#3b82f6');
                        L.circleMarker([item.lat, item.lon], { color, radius: 6, fillOpacity: 0.8 }).addTo(markers).bindPopup(item.location);
                        points.push([item.lat, item.lon]);
                        if(item.group==='A'||item.group==='all') pathA.push([item.lat, item.lon]);
                        if(item.group==='B'||item.group==='all') pathB.push([item.lat, item.lon]);
                    }
                });
                if(pathA.length > 1) L.polyline(pathA, { color: '#14b8a6', weight: 3, opacity: 0.5 }).addTo(paths);
                if(pathB.length > 1) L.polyline(pathB, { color: '#f97316', weight: 3, opacity: 0.5, dashArray: '10, 10' }).addTo(paths);
                if(points.length) map.fitBounds(points, { padding: [50, 50] });
            };

            const openAddExp = () => {
                isEdit.value = false;
                form.value = { id: Date.now(), title: '', originalAmount: 0, currency: 'EUR', payer: '媽媽', targetMembers: [...members], date: selDate.value };
                showExpModal.value = true;
                nextTick(() => lucide.createIcons());
            };

            const openEditExp = (exp) => {
                isEdit.value = true;
                form.value = JSON.parse(JSON.stringify(exp));
                showExpModal.value = true;
                nextTick(() => lucide.createIcons());
            };

            const saveExp = () => {
                const rate = form.value.currency === 'TWD' ? 1 : 34.5;
                const data = { ...form.value, twdAmount: form.value.originalAmount * rate, splitGroup: form.value.targetMembers.length === 5 ? 'all' : 'custom' };
                const idx = expenses.value.findIndex(e => e.id === data.id);
                if(idx > -1) expenses.value.splice(idx, 1, data);
                else expenses.value.push(data);
                saveToCloud(); showExpModal.value = false;
            };

            const delExp = () => { expenses.value = expenses.value.filter(e => e.id !== form.value.id); saveToCloud(); showExpModal.value = false; };
            const toggleM = (m) => {
                const arr = form.value.targetMembers;
                const idx = arr.indexOf(m);
                if(idx > -1) arr.splice(idx, 1); else arr.push(m);
            };

            const openAddItem = () => { isEdit.value = false; itemForm.value = { id: Date.now(), day: currentDay.value, time: '10:00', location: '', group: 'all', note: '' }; showItemModal.value = true; nextTick(()=>lucide.createIcons()); };
            const openEditItem = (item) => { isEdit.value = true; itemForm.value = JSON.parse(JSON.stringify(item)); showItemModal.value = true; nextTick(()=>lucide.createIcons()); };
            const saveItem = async () => {
                if(!itemForm.value.lat) {
                    try { const r = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${itemForm.value.location}`); const d = await r.json(); if(d.length) { itemForm.value.lat = d[0].lat; itemForm.value.lon = d[0].lon; } } catch(e) {}
                }
                const idx = itinerary.value.findIndex(i => i.id === itemForm.value.id);
                if(idx > -1) itinerary.value.splice(idx, 1, itemForm.value);
                else itinerary.value.push(itemForm.value);
                saveToCloud(); showItemModal.value = false;
            };
            const delItem = () => { itinerary.value = itinerary.value.filter(i => i.id !== itemForm.value.id); saveToCloud(); showItemModal.value = false; };

            onMounted(() => {
                lucide.createIcons();
                map = L.map('map', { zoomControl: false }).setView([52.3676, 4.9041], 13);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);
                markers.addTo(map); paths.addTo(map);
                
                onValue(dbRef(db, 'travel2026'), (snap) => {
                    const d = snap.val();
                    if(d) { itinerary.value = d.itinerary || []; expenses.value = d.expenses || []; dayTitles.value = d.dayTitles || {}; }
                    isLoaded.value = true;
                });
            });

            const sortedFilteredExp = computed(() => {
                return expenses.value.filter(e => expenseFilter.value === 'all' || (e.targetMembers || []).some(m => groups[expenseFilter.value].includes(m)))
                    .sort((a,b) => new Date(b.date) - new Date(a.date) || b.id - a.id);
            });

            return {
                activeTab, isLoaded, currentDay, mapDay, itineraryGroup, expenseFilter, selDate, itinerary, expenses, members, showFullList, showExpModal, showItemModal, isEdit, form, itemForm, weather, days,
                filteredItinerary: computed(() => itinerary.value.filter(i => i.day === currentDay.value && (itineraryGroup.value === 'all' || i.group === 'all' || i.group === itineraryGroup.value)).sort((a,b)=>a.time.localeCompare(b.time))),
                sortedFilteredExp,
                filteredTotal: computed(() => sortedFilteredExp.value.reduce((s, e) => s + e.twdAmount, 0)),
                dailyFilteredExp: computed(() => sortedFilteredExp.value.filter(e => e.date === selDate.value)),
                dailyTotal: computed(() => sortedFilteredExp.value.filter(e => e.date === selDate.value).reduce((s, e) => s + e.twdAmount, 0)),
                calendarDays: computed(() => {
                    const y = calDate.value.getFullYear(), m = calDate.value.getMonth();
                    const first = new Date(y, m, 1).getDay(), last = new Date(y, m+1, 0).getDate();
                    let arr = [];
                    for(let i=0; i<first; i++) arr.push(null);
                    for(let i=1; i<=last; i++) {
                        const dStr = `${y}-${String(m+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                        arr.push({ day: i, date: dStr, hasExpense: expenses.value.some(e => e.date === dStr) });
                    }
                    return arr;
                }),
                calYear: computed(()=>calDate.value.getFullYear()),
                calMonth: computed(()=>calDate.value.getMonth()),
                getGroupBg: (g) => ({all:'bg-blue-500', A:'bg-teal-500', B:'bg-orange-500', custom:'bg-purple-500'}[g] || 'bg-slate-400'),
                getGroupBorder: (g) => ({all:'border-l-blue-500', A:'border-l-teal-500', B:'border-l-orange-500', custom:'border-l-purple-500'}[g] || 'border-l-slate-400'),
                switchTab, openAddExp, openEditExp, saveExp, delExp, toggleM, openAddItem, openEditItem, saveItem, delItem, changeMonth: (v) => calDate.value = new Date(calDate.value.setMonth(calDate.value.getMonth()+v)),
                getSafeKey: (d) => d.replace('/','_'),
                updateDayTitle: (e) => { dayTitles.value[currentDay.value.replace('/','_')] = e.target.value; saveToCloud(); }
            };
        }
    }).mount('#app');
</script>
</body>
</html>
